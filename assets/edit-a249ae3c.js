import{a4 as Y,w as Z,ae as K,af as g,r as i,j as e,t as V,S as X,O as ee,ag as te,T as se,C as ae,ah as c,Y as b,Z as re,$ as ie,a0 as ne,a2 as oe,ai as de,aj as le,y as P,I as k,ak as ce,E as ue,al as he,F as xe,am as me,aa as f,ab as n,G as pe,ac as je,B as ge,L as be,a3 as fe,M as ye,N as Se,A as p,Q as w,W as ve}from"./index-019ce5a6.js";import"./table-head-7d54a6e5.js";import"./approve-dialog-1c59e89c.js";import{T as Ie}from"./TableFooter-12fd2237.js";const _e=()=>{const{id:y}=Y(),L=Z(),q=K({components:{MuiTable:{styleOverrides:{root:{borderCollapse:"separate",borderSpacing:0,borderColor:g.A200}}},MuiTableCell:{styleOverrides:{root:{border:"1px solid",borderColor:g.A200}}},MuiTableHead:{styleOverrides:{root:{backgroundColor:g.A200}}}}}),[E,A]=i.useState([]),[R,F]=i.useState([]),[o,u]=i.useState([]),[O,B]=i.useState(null),[h,S]=i.useState(""),[v,M]=i.useState(),[x,Q]=i.useState(),[W,G]=i.useState(),[D,j]=i.useState(!1),[r,I]=i.useState(),H=async()=>{var l,m,_,T,C;const t=await p.GetProductList(),a=await p.GetShopList(),s=await p.GetStockIn(y);A((l=t==null?void 0:t.data)==null?void 0:l.filter(d=>(d==null?void 0:d.is_stock_control)==1)),F(a==null?void 0:a.data),S((m=s==null?void 0:s.data)==null?void 0:m.shop_id),u((T=(_=s==null?void 0:s.data)==null?void 0:_.stock_in_detail)==null?void 0:T.map(d=>({...d,product_name:d.product_name+` (${d.product_code})`}))),M((C=s==null?void 0:s.data)==null?void 0:C.transaction_code)},$=()=>{let t=[...o],a=t.find(s=>s.product_id==x.id);a?a.qty+=1:(t.push({product_name:x.label,product_id:x.id,qty:1}),I(s=>({...s,products:t.length===0}))),u(t)},z=t=>{let a=[...o];a=a.filter(s=>s.product_id!=t),u(a)},N=(t,a)=>{let s=[...o],l=s.find(m=>m.product_id==t);l&&(l.qty=parseInt(a.target.value)),u(s)},J=async t=>{t.preventDefault(),j(!0);const a={transaction_code:v,shop_id:h,stocklist:o};if(o.length!==0&&h){const s=await p.EditStockIn(a,y);s.code===200?(w.success(s.message,{theme:"colored"}),setTimeout(()=>L("/stock-ins"),2e3)):(j(!1),w.error(s.message))}else I({shop:h==="",products:o.length===0}),j(!1)},U=()=>{const t=JSON.parse(localStorage.getItem("user"));B(t==null?void 0:t.role_id)};return i.useEffect(()=>{H(),U()},[]),i.useEffect(()=>{G(o.reduce((t,a)=>t+a.qty,0))},[o]),e.jsxs(V,{maxWidth:"xl",children:[e.jsx(X,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsxs(ee,{"aria-label":"breadcrumb",children:[e.jsx(te,{variant:"h4",underline:"hover",color:"inherit",href:"/stock-ins",children:"Stock In Management"}),e.jsx(se,{variant:"h4",children:"Edit Stock In"})]})}),e.jsx(ae,{sx:{padding:"1rem",minHeight:"50vh"},children:e.jsxs("form",{onSubmit:J,children:[e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:6,md:6,sm:12,children:e.jsx(b,{id:"outlined-read-only-input",label:"Transaction Id",value:v??"",InputProps:{readOnly:!0},sx:{width:"100%"}})}),e.jsx(c,{item:!0,xs:6,md:6,sm:12,children:e.jsxs(re,{fullWidth:!0,error:r==null?void 0:r.shop,children:[e.jsx(ie,{id:"demo-simple-select-label",children:"Shop"}),e.jsx(ne,{required:!0,labelId:"demo-simple-select-label",id:"demo-simple-select",value:h??"",label:"Shop",inputProps:{readOnly:O!==1},onChange:t=>{S(t.target.value)},children:R.map(t=>e.jsxs(oe,{value:t.id,children:[t.name," (",t.shop_code,")"]},t.id))}),e.jsx(de,{children:r!=null&&r.shop?"Select Shop!":" "})]})}),e.jsx(c,{item:!0,xs:8,md:8,sm:8,children:e.jsx(le,{freeSolo:!0,id:"product-list",value:x??null,options:E.map(t=>({label:t.product_name+` (${t.product_code})`,id:t.id})),onChange:(t,a)=>Q(a),renderInput:t=>e.jsx(b,{...t,label:"Products",error:r==null?void 0:r.products,helperText:r!=null&&r.products?"Add Product!":""})})}),e.jsx(c,{item:!0,xs:4,md:4,sm:4,sx:{display:"flex"},alignItems:"center",children:e.jsx(P,{variant:"contained",color:"primary",startIcon:e.jsx(k,{icon:"eva:plus-fill"}),onClick:$,children:"Add"})})]}),e.jsx(ce,{theme:q,children:e.jsx(ue,{component:he,sx:{mt:"1.5rem"},children:e.jsxs(xe,{sx:{minWidth:700},children:[e.jsx(me,{children:e.jsxs(f,{children:[e.jsx(n,{children:"#"}),e.jsx(n,{children:"Product"}),e.jsx(n,{align:"right",children:"Qty"}),e.jsx(n,{})]})}),e.jsx(pe,{children:o.map((t,a)=>e.jsxs(f,{children:[e.jsx(n,{component:"th",scope:"row",sx:{width:"4rem"},children:a+1}),e.jsx(n,{children:t.product_name}),e.jsx(n,{align:"right",sx:{width:"200px"},children:e.jsx(b,{required:!0,value:t.qty,type:"number",name:"qty",onChange:s=>N(t.product_id,s),id:"qty",variant:"outlined"})}),e.jsx(n,{align:"right",sx:{width:"4rem"},children:e.jsx(je,{onClick:()=>z(t.product_id),children:e.jsx(k,{icon:"eva:trash-2-outline",sx:{color:"error.main"}})})})]},t.product_id))}),e.jsx(Ie,{children:e.jsxs(f,{children:[e.jsx(n,{component:"th",align:"right",colSpan:2,scope:"row",sx:{fontSize:"14px",fontWeight:"bold"},children:"Total Qty"}),e.jsx(n,{align:"right",sx:{fontSize:"14px",fontWeight:"bold"},children:W}),e.jsx(n,{})]})})]})})}),e.jsxs(ge,{sx:{pb:3,display:"flex",mt:2,float:"right"},children:[e.jsx(be,{underline:"hover",color:"primary",to:"/stock-ins",children:e.jsx(P,{variant:"outlined",color:"primary",sx:{borderRadius:1,marginRight:1},children:"Cancel"})}),e.jsx(fe,{type:"submit",size:"medium",variant:"contained",sx:{borderRadius:1},loading:D,children:"Update"})]})]})}),e.jsx(ye,{position:Se,autoClose:1500})]})},we=()=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{children:e.jsx("title",{children:" Juvenus POS | Stock In "})}),e.jsx(_e,{})]});export{we as default};
