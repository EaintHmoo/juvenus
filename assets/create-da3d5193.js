import{w as $,ae as J,af as b,r,j as e,t as Y,S as Z,O as K,ag as U,T as V,C as X,ah as u,Y as f,Z as ee,$ as te,a0 as se,a2 as ae,ai as re,aj as ne,y as C,I as T,ak as oe,E as ie,al as le,F as de,am as ce,aa as S,ab as o,G as ue,ac as he,B as xe,L as me,a3 as pe,M as je,N as ge,A as m,Q as k,W as be}from"./index-019ce5a6.js";import"./table-head-7d54a6e5.js";import"./approve-dialog-1c59e89c.js";import{T as fe}from"./TableFooter-12fd2237.js";const Se=()=>{const P=$(),_=J({components:{MuiTable:{styleOverrides:{root:{borderCollapse:"separate",borderSpacing:0,borderColor:b.A200}}},MuiTableCell:{styleOverrides:{root:{border:"1px solid",borderColor:b.A200}}},MuiTableHead:{styleOverrides:{root:{backgroundColor:b.A200}}}}}),[w,q]=r.useState([]),[l,A]=r.useState([]),[i,p]=r.useState([]),[j,L]=r.useState(null),[O,R]=r.useState(null),[h,y]=r.useState(""),[v,F]=r.useState(),[x,B]=r.useState(),[E,M]=r.useState(),[Q,g]=r.useState(!1),[n,I]=r.useState(),W=()=>{const t=JSON.parse(localStorage.getItem("user"));L(t==null?void 0:t.role_id),R(t==null?void 0:t.shop_id)};r.useEffect(()=>{j!==1&&(l==null?void 0:l.length)>0&&y(O||"")},[j,l]);const G=async()=>{var d;const t=await m.GetProductList(),s=await m.GetShopList(),a=await m.GetTransactionCode();q((d=t==null?void 0:t.data)==null?void 0:d.filter(c=>(c==null?void 0:c.is_stock_control)==1)),A(s==null?void 0:s.data),F(a==null?void 0:a.data)},D=()=>{let t=[...i],s=t.find(a=>a.product_id==x.id);s?s.qty+=1:t.push({product_name:x.label,product_id:x.id,qty:1}),p(t),I(a=>({...a,products:t.length===0}))},H=t=>{let s=[...i];s=s.filter(a=>a.product_id!=t),p(s)},z=(t,s)=>{let a=[...i],d=a.find(c=>c.product_id==t);d&&(d.qty=parseInt(s.target.value)),p(a)},N=async t=>{t.preventDefault(),g(!0);const s={transaction_code:v,shop_id:h,stocklist:i};if(i.length!==0&&h){const a=await m.CreateStockIn(s);a.code===200?(k.success(a.message,{theme:"colored"}),setTimeout(()=>P("/stock-ins"),2e3)):(g(!1),k.error(a.message))}else I({shop:h==="",products:i.length===0}),g(!1)};return r.useEffect(()=>{G(),W()},[]),r.useEffect(()=>{M(i.reduce((t,s)=>t+s.qty,0))},[i]),e.jsxs(Y,{maxWidth:"xl",children:[e.jsx(Z,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsxs(K,{"aria-label":"breadcrumb",children:[e.jsx(U,{variant:"h4",underline:"hover",color:"inherit",href:"/stock-ins",children:"Stock In Management"}),e.jsx(V,{variant:"h4",children:"Create Stock In"})]})}),e.jsx(X,{sx:{padding:"1rem",minHeight:"50vh"},children:e.jsxs("form",{onSubmit:N,children:[e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:6,md:6,sm:12,children:e.jsx(f,{id:"outlined-read-only-input",label:"Transaction Id",value:v??"",InputProps:{readOnly:!0},sx:{width:"100%"}})}),e.jsx(u,{item:!0,xs:6,md:6,sm:12,children:e.jsxs(ee,{fullWidth:!0,error:n==null?void 0:n.shop,children:[e.jsx(te,{id:"demo-simple-select-label",children:"Shop"}),e.jsx(se,{required:!0,labelId:"demo-simple-select-label",id:"demo-simple-select",value:h,label:"Shop",inputProps:{readOnly:j!==1},onChange:t=>{y(t.target.value)},children:l.map(t=>e.jsxs(ae,{value:t.id,children:[t.name," (",t.shop_code,")"]},t.id))}),e.jsx(re,{children:n!=null&&n.shop?"Select Shop!":" "})]})}),e.jsx(u,{item:!0,xs:8,md:8,sm:8,children:e.jsx(ne,{freeSolo:!0,id:"product-list",value:x||null,options:w.map(t=>({label:t.product_name+` (${t.product_code})`,id:t.id})),onChange:(t,s)=>B(s),renderInput:t=>e.jsx(f,{...t,label:"Products",error:n==null?void 0:n.products,helperText:n!=null&&n.products?"Add Product!":""})})}),e.jsx(u,{item:!0,xs:4,md:4,sm:4,sx:{display:"flex"},alignItems:"center",children:e.jsx(C,{variant:"contained",color:"primary",startIcon:e.jsx(T,{icon:"eva:plus-fill"}),onClick:D,children:"Add"})})]}),e.jsx(oe,{theme:_,children:e.jsx(ie,{component:le,sx:{mt:"1.5rem"},children:e.jsxs(de,{sx:{minWidth:700},children:[e.jsx(ce,{children:e.jsxs(S,{children:[e.jsx(o,{children:"#"}),e.jsx(o,{children:"Product"}),e.jsx(o,{align:"right",children:"Qty"}),e.jsx(o,{})]})}),e.jsx(ue,{children:i.map((t,s)=>e.jsxs(S,{children:[e.jsx(o,{component:"th",scope:"row",sx:{width:"4rem"},children:s+1}),e.jsx(o,{children:t.product_name}),e.jsx(o,{align:"right",sx:{width:"200px"},children:e.jsx(f,{required:!0,value:t.qty,type:"number",name:"qty",onChange:a=>z(t.product_id,a),id:"qty",variant:"outlined"})}),e.jsx(o,{align:"right",sx:{width:"4rem"},children:e.jsx(he,{onClick:()=>H(t.product_id),children:e.jsx(T,{icon:"eva:trash-2-outline",sx:{color:"error.main"}})})})]},t.product_id))}),e.jsx(fe,{children:e.jsxs(S,{children:[e.jsx(o,{component:"th",align:"right",colSpan:2,scope:"row",sx:{fontSize:"14px",fontWeight:"bold"},children:"Total Qty"}),e.jsx(o,{align:"right",sx:{fontSize:"14px",fontWeight:"bold"},children:E}),e.jsx(o,{})]})})]})})}),e.jsxs(xe,{sx:{pb:3,display:"flex",mt:2,float:"right"},children:[e.jsx(me,{underline:"hover",color:"primary",to:"/stock-ins",children:e.jsx(C,{variant:"outlined",color:"primary",sx:{borderRadius:1,marginRight:1},children:"Cancel"})}),e.jsx(pe,{type:"submit",size:"medium",variant:"contained",sx:{borderRadius:1},loading:Q,children:"Create"})]})]})}),e.jsx(je,{position:ge,autoClose:1500})]})},Te=()=>e.jsxs(e.Fragment,{children:[e.jsx(be,{children:e.jsx("title",{children:" Juvenus POS | Stock In "})}),e.jsx(Se,{})]});export{Te as default};
